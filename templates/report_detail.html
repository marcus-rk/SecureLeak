{#
    Individual report detail card.
    `reports.view_report` passes a single report dict with id, status, severity, and description fields.
    Provides a back link to the listing so browsing remains in the reports blueprint.
#}
{% extends "layout.html" %}
{% block content %}
    <section class="reports card">
        <h2>Report #{{ report.id }}: {{ report.title }}</h2>
        <div class="report-detail">
            <div class="report-meta">
                <dl>
                    <div>
                        <dt>Owner</dt>
                        <dd>
                            {{ report.owner_username or 'Unknown' }}
                        </dd>
                    </div>
                    <div>
                        <dt>Status</dt>
                        <dd>
                            {{ report.status|capitalize }}
                        </dd>
                    </div>
                    <div>
                        <dt>Severity</dt>
                        <dd>
                            {{ report.severity|capitalize }}
                        </dd>
                    </div>
                </dl>
            </div>

            <div class="report-description">
                <h3>Description</h3>
                <p>{{ report.description }}</p>
            </div>
        </div>
        {% if report.image_name %}
            <div class="report-attachment">
                <img src="{{ url_for('reports.report_file', report_id=report.id, name=report.image_name) }}" alt="Attachment">
            </div>
        {% endif %}
        <section class="comments card">
            <h3>Comments</h3>
            {% if comments and comments|length > 0 %}
                <ul class="comment-list">
                    {% for c in comments %}
                        <li class="comment">
                            <div class="comment__meta">
                                <strong>{{ c.author_username or 'Deleted user' }}</strong>
                                <span>â€¢</span>
                                <time datetime="{{ c.created_at }}">{{ c.created_at }}</time>
                            </div>
                            <div class="comment__body">{{ c.content }}</div>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p class="muted">No comments yet.</p>
            {% endif %}

            {% if session.get('user_id') %}
                <form action="{{ url_for('reports.add_comment', report_id=report.id) }}" method="post" class="comment-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <label for="comment-body">Add a comment</label>
                    <textarea id="comment-body" name="body" rows="4" maxlength="2000" required></textarea>
                    <div>
                        <button type="submit">Post comment</button>
                    </div>
                </form>
            {% else %}
                <p><a class="button-link" href="{{ url_for('auth.login') }}">Login</a> to post a comment.</p>
            {% endif %}
        </section>
        <div class="actions actions--end">
            <a class="button-link" href="{{ url_for('reports.list_reports') }}">Back to reports</a>
        </div>
    </section>
{% endblock %}
